(function(){var id="pagebeforeshow",fb=".dv-load-at-top",Tb="data-view-id",bc="#app-btn-menu",pb="icon",Nb="search",Nc=".app-btn",ac="div.app-menu-footer",Mc="touchmove",Zb="touchstart",O="margin-right",C="hidden",B="auto",uc="{0} - {1}",tc="#app-text-search",Lc="ui-btn-active",Yb="Main",sc="appawake",hb="show",Mb="external",ob='<li data-role="list-divider" data-theme="b"></li>',Lb=".welcome",Kb="#app-back",Kc=".message",z="open",nb="</div>",Jc='<div role="main" class="ui-content">',Ic="div.ui-popup-active div:first",rc="data-field-name",Hc="data-content-type",Z="src",U='<a rel="external"/>',zb="<div>",qc="placeholder",mb="value",yb="false",Jb="textarea",pc='div[data-role="collapsible-set"]',oc='div[data-role="collapsible"]',Gc="lookup-details-hidden",Xb="input:text",X="string",Fc='<li data-role="list-divider" class="app-list-instruction"/>',eb="<span>",nc="{0}blob.ashx?{1}=t|{2}",lb="data-theme",K="<a>",mc=".dv-load-at-bottom",J="none",G="destroy",Wb='ul[data-role="listview"]',Ib="select",s="ui-btn-b",m="data-context",r="<li>",t="#",h="href",kd="undefined",W="hide",Hb="ActionBar",xb="tel:",T="phone",lc='ul[data-role="listview"] a.ui-btn-b',Vb=".app-tab-active",gb="eye",y="b",I="refresh",E="Select",Ec="#app-panel-view-options",F="check",N="asc",H="toggle",db="#app-panel-context",wb="swipe",q="back",w="bars",S="context-action",Ub="data-icon",P="li",f="a",g="vclick",cb="right",Dc="sidebarIsUndocked",Cc="app-sidebar-undocked",Y="scroll",e="",p="overflow-y",D="html",n="ul",R="vmouseout",Gb="vmouseover",d=200,o="close",a=false,c=true,Bb=".app-sidebar-right",k="id",dc=".ui-panel-inner",Ab=":visible",cc="#app-sidebar-right",b=null,l=-1,Zc=navigator.userAgent,ld=navigator.platform,Pc=/iPhone|iPad|iPod/.test(ld)&&Zc.indexOf("AppleWebKit")>l,Kd=/chrom(e|ium)/i.test(Zc),Fd=/safari/i.test(Zc),M=ld.match(/Win\d+|Mac/i)!=b,vd=/^s*(\w+)\s*\|s*(.+)$/,rd=/(<(\/*(a|span).*?>)|(&nbsp;)|onclick=\".+?\")/g,qd=/(<(\/*(b).*?>))/g,td=/phone/i,Ed=/^\s*(\w+)(\s+(\w+)\s*)?$/,u,jb,qb,ib=Web.DataViewResources,hd=ib.Views,Jd=ib.Menu,Bc=ib.Data,wd=ib.Pager,hc=ib.ModalPopup,tb=ib.HeaderFilter,x=ib.Mobile,Cd=ib.Grid,Bd=ib.Form,L=Web.MembershipResources&&Web.MembershipResources.Bar,Gd=ib.InfoBar,ec,bb,Id,zc,ub,Db,Ob,Eb,Cb,fc,bd,Pb,kb,Uc,Oc,vc={},Q,kc,rb,A;function j(a){$appfactory.mobile.activeLink(a)}function ad(){u.find("> *").hide()}function Yc(){qb&&qb._updateLastActivity()}function wc(){return $(document).height()>$(window).height()}function V(){if(!Uc)Uc=$(cc);return Uc}function ab(){return V().is(Ab)}function gc(a){if(a.callback)a.callback(a.context);else if(a.href)window.location.href=a.href}function Qb(){var b=V(),a=b.find(dc),d=a.find(".ui-listview"),c=a.find(".app-menu-footer");return $(window).height()<d.outerHeight()+c.outerHeight()}function vb(){var a=$.mobile.activePage;return a?a.attr(k):"_"}function cd(a){if(a.length){var b=vb(),d=b,c=vc._lastPageId;if(a.is(Bb)){if(c&&c!=b)d=c;vc._lastPageId=b}vc[d+"_"+a.attr(k)]=a.find(dc).scrollTop()}}function nd(a){a.length&&a.find(dc).scrollTop(vc[vb()+"_"+a.attr(k)]||0)}function ic(){return Db==c}function Wc(){var b=Oc;Oc=a;return b==c}function Ac(a){setTimeout(function(){$("div.ui-panel-open").panel(o,a!=c)},d)}function sb(a){if(Pb){clearTimeout(Pb);Pb=b}if(!a)Pb=setTimeout(function(){var c=V();cd(c);$appfactory.mobile.refreshContext(c);Pb=b;if(M){var a=ab();if(a){V().trigger(Gb).trigger(R);Fd&&V().find(n).css("margin-bottom","-1.1em")}$(D).css(p,wc()?e:a&&Qb()?e:Y)}},250)}function jd(e,d){var a="AppFactoryUserVars";function c(){var b=encodeURIComponent(JSON.stringify(rb)),d=(new Date).getDate()+7,c=new Date;c.setDate(d);b=String.format("{0}={1}; expires={2}; path=/",a,b,c.toUTCString());document.cookie=b}if(rb==b){$(document.cookie.split(";")).each(function(){var b=this.trim();if(b.startsWith(a)){rb=decodeURIComponent(b.substring(a.length+1));try{rb=JSON.parse(rb);c()}catch(d){}}});if(!rb)rb={}}if(d!=b){rb[e]=d;c()}else return rb[e]}function pd(){u.toggleClass(Cc);kb=!kb;jd(Dc,kb)}function gd(f,j){var g="data-activator",e={text:j,resolved:c,description:b,type:b},d=f.attr(g);if(!d){var i=f.closest("div[data-activator]");d=i.attr(g);if(d)f=i}if(!d)d=$(f).prev(".DataViewHeader").text();if(d){var h=vd.exec(d);if(h){e.text=h[2];e.type=h[1]}else e.text=d}else e.resolved=a;e.description=f.attr("data-activator-description");return e}function Xc(a){return a.tagged("mobile-action-call")||a.Name.match(td)}function Ad(b){var a=b.ItemsStyle;return!String.isNullOrEmpty(a)&&a!="CheckBoxList"}function fd(a,e){if(a<0)a=0;var b=10,g=$(window),d=g.scrollTop(),c=(a-d)/2,h=a;a=d;function f(){a+=c;c=c/2;b--;g.scrollTop(b==0?h:a);if(b>0)setTimeout(f,25);else e&&e()}f()}function ed(l,m){var i="app-inactive",h=$(l),p=$appfactory.mobile;Fb();fc=b;if(h.length==0){h=$('<div data-position-fixed="true" data-role="panel" data-theme="a" data-position="right" data-display="overlay"><ul/><div class="app-menu-footer"/></div>').appendTo(u).panel({beforeopen:function(){Ob=c;p.pageScrolling(a);m&&m();if(ab()){V().addClass(i);if(M){var b=V().trigger(R).width();h.width(b).next().css(cb,b)}}else M&&h.width(e)},open:function(){Ob=a;j()},beforeclose:function(){Ob=c;cd(h)},close:function(){Ob=a;fc&&fc();fc=b;ab()&&V().removeClass(i);p.pageScrolling(c)}});l.match(/^#/)&&h.attr(k,l.substring(1));h.find(n).listview().on(g,function(e){var g=$(e.target).closest(f),i=g.closest(P).attr(Ub);if(ic()||Ob)return a;var b=g.data(S);if(b&&!bd){j(g);if(b.dataRel)return c;setTimeout(function(){j();h.panel(o,i!=w&&i!=q);fc=function(){setTimeout(function(){gc(b)},10)}},d)}bd=a;e.preventDefault();e.stopPropagation();return a}).on(wb,function(){})}return h}function jc(){if(ab())V().trigger(Gb);else $(db).panel(H)}function Fb(){A&&$(A).blur()}function Rb(a){return ed(a,function(){$appfactory.mobile.refreshContext(a,Q)}).panel(H)}function od(e){var b=new Sys.StringBuilder,f=e._fields,a,c,d;if(e.get_sortExpression())for(c=0;c<f.length;c++){a=e._allFields[f[c].AliasIndex];if(a.AllowSorting){d=Sb(a.Name);if(d){!b.isEmpty()&&b.append(", ");b.appendFormat("{1} | {0}",a.HeaderText,yc(a,d))}}}return b.toString()}function md(){var a=$appfactory.mobile.dataView(),c=new Sys.StringBuilder;if(kc!=b){$(a._fields).each(function(){var d=a._allFields[this.AliasIndex],b=Sb(d.Name);if(b){!c.isEmpty()&&c.append(",");c.appendFormat("{0} {1}",d.Name,b)}});a._sortExpression=c.toString();a.sync()}}function Sb(g,c){var f=kc==b?$appfactory.mobile.dataView().get_sortExpression()||e:kc,h=f.split($appfactory._simpleListRegex),a,d;if(c==b){if(f)for(a=0;a<h.length;a++){d=h[a].match(Ed);if(d[1]==g)return d[3]||N}return b}else kc=c?String.format("{0} {1}",g,c):e}function yc(d,c){var b=tb.GenericSortAscending,a=tb.GenericSortDescending;switch(d.FilterType){case"Text":b=tb.StringSortAscending;a=tb.StringSortDescending;break;case"Date":b=tb.DateSortAscending;a=tb.DateSortDescending}return c==N?b:a}function xd(){var f="#app-panel-sort-fields";kc=b;for(var i=$appfactory.mobile.dataView(),j=i.get_view().Label,k=i._fields,m=i._allFields,d,h=[{text:x.Back,icon:q,callback:jc},{text:String.format(x.SortByField,j)}],l,e=0;e<k.length;e++){d=k[e];d=m[d.AliasIndex];if(d.AllowSorting){var g=Sb(d.Name);if(g)l=c;h.push({text:d.HeaderText,context:d,icon:g?g==N?"arrow-u":"arrow-d":b,desc:g?yc(d,g):b,callback:function(c){var b="desc",h=Q,e=Sb(c.Name);function g(){Q=h;$(f).panel(H)}function d(b,a){if(Sb(b.Name)==a)g();else{Sb(b.Name,a);md()}}Q=[{text:x.Back,icon:q,callback:g}];Q.push({text:String.format(x.SortByOptions,j,c.HeaderText)});Q.push({text:yc(c,N),callback:function(){d(c,N)},icon:e==N?F:a});Q.push({text:yc(c,b),callback:function(){d(c,b)},icon:e==b?F:a});Q.push({text:x.DefaultOption,callback:function(){d(c,a)},icon:e?a:F});Rb("#app-panel-sort-options")}})}}for(e=2;e<h.length;e++)if(l&&!h[e].icon)h[e].icon=a;Q=h;Rb(f)}function sd(){var b=$appfactory.mobile.dataView(),a=[{text:x.Back,icon:q,callback:jc},{text:"Filters are not available at this time."}];Q=a;Rb(Ec)}function yd(){var f=$appfactory.mobile.pageInfo(),e=f.dataView,h=e.get_view(),i=e.get_views(),g=0,d=[{text:x.Back,icon:q,callback:jc},{text:x.AlternativeView}];$(i).each(function(){var c=this,i=c.Label==h.Label;if(c.Type!="Form"&&c.ShowInSelector||c.Id==h.Id){d.push({text:c.Label,icon:i?F:a,callback:function(){e._forceSync();e.extension()._commandRow=b;e.executeCommand({commandName:E,commandArgument:c.Id});f.text=c.Label;f.resolved=a}});g++}});g==1&&d.splice(d.length-2,2);if(e.get_isGrid()){d.push({text:x.PresentationStyle});d.push({text:x.List,icon:F,callback:function(){}});d.push({text:x.Grid,disabled:c,icon:a,callback:function(){}})}d.push({});d.push({text:wd.Refresh,icon:I,callback:function(){e.sync()}});Q=d;Rb(Ec)}function dd(b,i,c){var e=b._parentDataViewId&&!b._lookupInfo,h=b.extension().itemMap(),f=b._allFields[h.heading];c&&c.length&&i.push({text:f.text(c[f.Index]),theme:y,toolbar:a,icon:gb,toolbar:!e,callback:function(){if(e){function h(){fd(0,function(){$appfactory.mobile.headingOnDemand().blink($.mobile.activePage.find(".ui-collapsible-heading:first a"))})}var b=$.mobile.activePage.find('div[data-role="navbar"] a:first');if(b.length&&!b.is(Vb)){b.trigger(g);setTimeout(h,d)}else h()}else{var j=$appfactory.mobile.pageInfo(),a=$appfactory.mobile.content(j.id).parent().find(lc),c=$appfactory.mobile.screen();if(a.length){var f=a.offset().top,k=a.outerHeight();function i(b){$appfactory.mobile.blink(a,b)}if(f>=c.top-5&&f+k<c.bottom)i(function(){$appfactory.mobile.infoView(j.dataView,ab())});else{$(window).scrollTop(f-c.height/2);i()}}}}})}function Qc(a,d,c){c&&$(a._fields).each(function(){var e=a._allFields[this.AliasIndex];if(Xc(e)){var f=c[e.Index];f!=b&&d.push({text:e.text(f),desc:e.HeaderText,icon:T,href:xb+f})}})}function Dd(c){var a=b;switch(c.CommandName){case"Delete":a="delete";break;case"New":a="plus";break;case"Edit":a="edit";break;case"Insert":case"Update":a=F;break;case"Cancel":a=q}return a}function Tc(n,c,d,i){var o=c.rowIsSelected(i),h,k=[],r,p=c.get_viewId(),m=c.get_isGrid(),j={},f,e,g;$(c.actionGroups(n)).each(function(){var r=this;if(r.Scope==Hb&&!r.Flat&&r.Id!=n)d.push({text:r.HeaderText,icon:w,context:r,callback:function(a){Q=[{text:x.Back,icon:q,callback:jc},{}];Tc(a.Id,c,Q,i);Rb("#app-panel-group-actions")}});else(!r.Scope.match(/Grid|ActionColumn/)||o&&m)&&$(this.Actions).each(function(){var n=this,q=n.CommandName+"/"+n.CommandArgument,o=k.indexOf(q)==l&&(!n.CommandName||!n.CommandName.match(/^(DataSheet|Grid|Export(Rowset|Rss)|Import|BatchEdit)$/));g=n.CommandName?function(){if(n.CommandName=="Cancel")window.history.go(l);else{function a(){c.extension().command(i,n.CommandName,n.CommandArgument,n.CausesValidation,n.Path)}if(!String.isNullOrEmpty(n.Confirmation))c._confirm({action:n},function(b){$appfactory.confirm(b,function(){a()})});else a()}}:b;e=b;if(o){f=n.CommandName&&n.CommandName.match(/^(Select|Edit|New|Duplicate)$/);if(f&&m&&(n.CommandArgument==p||String.isNullOrEmpty(n.CommandArgument))){j[n.CommandName]=d[d.length-1];o=a}else if(f)e=j[n.CommandName]}if(o&&!g&&r.Scope.match(/Grid|ActionColumn/))o=a;if(o){k.push(q);h={text:n.HeaderText,callback:g,icon:Dd(n),command:n.CommandName,argument:n.CommandArgument};if(e)Array.insert(d,d.indexOf(e)+1,h);else d.push(h)}})})}function ud(b){var a=$appfactory.mobile.pageInfo(b._id);if(!a.resolved){a.text=b.get_view().Label;a.resolved=c;$appfactory.mobile.toolbar($appfactory.mobile.title())}}function zd(i){var g=i._fields,e=i._allFields,d={heading:b,thumb:b,aside:b,count:b,desc:[],descLabels:[],descPara:[]},f=a;$(e).each(function(h){var a=e[h],b=a.AliasIndex,i=e[b];if(a.tagged("mobile-")){f=c;var g=a.tagged("mobile-item-label");if(a.tagged("mobile-item-heading"))d.heading=b;if(a.tagged("mobile-item-desc")){d.desc.push(b);if(g)d.descLabels[d.desc.length-1]=c;if(a.tagged("mobile-item-para"))d.descPara[d.desc.length-1]=c}if(a.tagged("mobile-item-count")){d.count=b;d.countLabel=g}if(a.tagged("mobile-item-aside")){d.aside=b;d.asideLabel=g}if(a.tagged("mobile-item-thumb"))d.thumb=b}});if(f){if(d.heading==b)d.heading=g[0].AliasIndex}else{var h=c;function j(a){var g=this;if(!g.Hidden)if(g.OnDemand){if(d.thumb==b&&g.OnDemandStyle==0)d.thumb=a}else if(!h||g.ShowInSummary){a=g.AliasIndex;var i=e[a],k=i.Type.match(/^Date/),j=i.Type!="String"&&!i.OnDemand;if(d.heading==b)d.heading=a;else if(d.aside==b&&k)d.aside=a;else if(d.count==b&&j&&!k)d.count=a;else{d.desc.push(a);if(j)d.descLabels[d.desc.length-1]=a}f=c}}$(g).each(j);if(!f){h=a;$(g).each(j)}}return d}function xc(e){return{transition:e||"pop",positionTo:"window",afteropen:function(){$.mobile.loading(W);$appfactory.mobile.pageScrolling(a);var c=zc;c&&setTimeout(function(){c()},d);zc=b},afterclose:function(){$appfactory.mobile.pageScrolling(c);var a=ub;a&&setTimeout(function(){a()},d);ub=b}}}if(typeof Web==kd)Web={DataView:{}};Web.DataView.MobileBase=function(){Web.DataView.MobileBase.initializeBase(this)};Web.DataView.MobileBase.prototype={initialize:function(){},show:function(){},hide:function(){},systemFilter:function(){return b},reset:function(){},wait:function(){},dataView:function(a){if(a==b)return this._dataView;else this._dataView=a},inserting:function(){return this.dataView().get_isInserting()},editing:function(){return this.dataView().get_isEditing()},content:function(){return $appfactory.mobile.content(this._dataView._id)},commandRow:function(a){if(a==b)return this._commandRow;else{var c=this._commandRow=a.slice(0);this.dataView()._rows=[a];return c}},command:function(f,b,c,a,e){this.commandRow(f);var d=this.dataView();d.executeRowCommand(0,b,c,a,e)},action:function(g,f,a,e,b,c){this.commandRow(g);var d=this.dataView();d.executeAction(0,f,a,e,b,c)},itemMap:function(){return zd(this.dataView())},stateChanged:function(){sb()},lookupInfo:function(b){var a=this.dataView();if(arguments.length)a._lookupInfo=b;else return a._lookupInfo},viewDescription:function(){var b=this.dataView(),a=b.get_view().HeaderText;a=b._formatViewText(hd.DefaultDescriptions[a],c,a);return a},executeInContext:function(h,e,d){var c=this,g=c.lookupInfo(),f=[];d&&c.lookupInfo(b);c.context(f);$(f).each(function(){var c=this,d=c.command;if(d&&d==h&&(e==b||c.argument==e)){gc(c);return a}});d&&c.lookupInfo(g)}};Web.DataView.Extensions={};Web.DataView.prototype.mobileUpdated=function(){var a=this,b=gd($(a._element),document.title);if(a._pageSize<25)a._pageSize=25;var c={id:a.get_id(),text:b.text,dataView:a};$appfactory.mobile.pageInfo(c);if(!a._hidden&&!a._filterSource&&!$appfactory.mobile._appLoaded)var d=$('<a class="app-action-navigate" ></a>').attr(h,t+c.id).appendTo($(r).appendTo($appfactory.mobile.pageMenu())).text(b.text)};Web.DataView.Extensions.Grid=function(a){return new Web.DataView.MobileGrid(a)};Web.DataView.Extensions.DataSheet=function(a){return new Web.DataView.MobileGrid(a)};Web.DataView.MobileGrid=function(a){Web.DataView.MobileGrid.initializeBase(this);this.dataView(a)};Web.DataView.MobileGrid.prototype={options:function(){var a=this.dataView();return{quickFind:a.get_isGrid()&&a.get_showQuickFind(),filterDetails:c}},tap:function(f,d){var b=this,c=b.dataView();if(c._busy())return;if(c._hasKey()){b.command(f,E);d&&$.mobile.activePage.find('ul[data-role="listview"] li a').each(function(){var d=$(this),b=d.data(m);if(b&&c.rowIsSelected(b.row)){d.addClass(s);return a}});if(!d||d==Ib)if(b.lookupInfo())b.executeInContext(E);else{var e=[];$appfactory.mobile.navContext(e);$(e).each(function(){var b=this;if(b.text&&b.icon!=T&&b.icon!=w&&b.icon!=gb){gc(b);return a}})}}sb()},clearSelection:function(b){b&&$.mobile.activePage.find(lc).removeClass(s);var a=this.dataView();a._clearSelectedKey();a._forgetSelectedRow(c);delete this._commandRow;sb()},quickFind:function(c){var a=this.dataView();if(c!=b){a.set_quickFindText(c);a._executeQuickFind(c)}else return a._quickFindText?a._quickFindText:e},dispose:function(){var a=this.content().next(Wb);a.find(f).data(m,b);a.listview(G).remove()},refresh:function(){var w="li:first",r="a.ui-btn-b:first",n="a.ui-btn-b",p=".ui-btn-b",u=this,e=u,o=e.pageIndex(),h=e.dataView(),Z=h._fields,t=h._allFields,F=e.content(),z=e.visibleDataRows(o),i=F.next(Wb),D=u.pageSize(),S=o>0,R=o<e.pageCount()-1,Y,C,k=e.itemMap(),T=h.get_showRowNumber()==c,v=e._reset;function N(){i.find(f).data(m,b);i.find(P).remove();$(window).scrollTop(0)}if(!z){v&&N();h.goToPage(o,c);return}if(!u._loaded){u._loaded=c;$appfactory.mobile.search({allow:u.options().quickFind})}if(!i.length){F.hide();i=$('<ul data-role="listview" class="app-listview"/>').insertAfter(F).listview().bind("taphold",function(l){if(Wc())return a;if(h._busy())return;var b=$(l.target).closest(f),k=b.data(m),g=h.multiSelect();if(b.closest(P).is(".dv-item")){if(b.is(p)){b.removeClass(s);if(!g){e.clearSelection();if(e.lookupInfo()){j(b);setTimeout(function(){j();e.executeInContext("Clear")},d)}else{j(b);setTimeout(function(){j()},d)}}}else if(h._hasKey()){!g&&i.find(n).removeClass(s);b.addClass(s);e.tap(k.row,J);j(b);setTimeout(function(){j()},d)}C=c}return a}).on(g,function(k){if(Wc())return a;var b=$(k.target).closest(f);if(b.length){var o=e.pageCount();function g(a){if(!h._busy()){e._loadAtTop=!a;e.pageIndex(e.pageIndex(a?"bottom":"top")+(a?1:l));e.refresh();h._busy()&&$.mobile.loading(W)}}if(b.is(mc))g(c);else if(b.is(".dv-load-at-top:visible"))g(a);else{if(C){C=a;return}if(h.multiSelect()){if(i.find(r).length)if(b.is(p))b.removeClass(s);else b.addClass(s)}else{j(b);setTimeout(function(){j();if(!h.multiSelect()){var a=b.data(m);if(a){if(h._hasKey()){i.find(n).removeClass(s);b.addClass(s)}e.tap(a.row)}else b.is(".dv-action-refresh")&&h.sync()}},d)}}}return a})}v&&N();var A=i.find("li:last"),q,H,B=o*D;!A.length&&ud(h);if(S&&A.length==0)G=$(String.format('<li data-icon="refresh"><a class="dv-load-at-top"><p>{0}</p></a></li>',tb.Loading)).appendTo(i);if(e._loadAtTop){q=i.find(w);H=q.offset().top+q.height()-$appfactory.mobile.screen().top;z=z.reverse()}else A.remove();$(z).each(function(z){var f='<span class="app-item-label"/>',g=this,d,p=$('<li class="dv-item"/>');if(e._loadAtTop)p.insertAfter(q);else p.appendTo(i);var j=$(K).appendTo(p).data(m,{row:this.slice(0),pageIndex:o});if(h.rowIsSelected(g)){p.attr(lb,y);if(!e.commandRow()){h._forgetSelectedRow(c);e.command(g,E)}}if(k.thumb!=b){d=g[k.thumb];var C=h.resolveClientUrl(h.get_appRootPath()),A=t[k.thumb],F=$('<img class="ui-li-thumb"/>').appendTo(j).attr({src:String.format(nc,C,A.OnDemandHandler,d)})}if(k.aside!=b){var l=$('<p class="ui-li-aside"/>').appendTo(j),s=t[k.aside];d=g[k.aside];d=s.text(d);if(s.HtmlEncode)l.text(d);else l.html(d);k.asideLabel&&$(f).insertBefore(l.contents()).text(s.HeaderText+":")}var x=$("<h3>").appendTo(j),w=t[k.heading];d=g[k.heading];d=w.text(d);if(T)d=String.format("{0}. {1}",e._loadAtTop?B+D-z:B+z+1,d);if(w.HtmlEncode)x.text(d);else x.html(d);if(k.count!=b&&(l==b||k.desc.length)){var v=$('<span class="ui-li-count"/>').appendTo(j),u=t[k.count];d=g[k.count];d=u.text(d);if(u.HtmlEncode)v.text(d);else v.html(d);k.countLabel&&$(f).insertBefore(v.contents()).text(u.HeaderText+":")}if(k.desc.length){var n=$("<p>").appendTo(j),r=c;$(k.desc).each(function(i){var b=this,e=t[b],l=k.descLabels[i],m=k.descPara[i];if(m){r=c;n=$("<p>").appendTo(j).insertAfter(n)}if(r)r=a;else $('<span class="app-item-desc-divider"/>').appendTo(n);d=g[b];var h=$(eb).appendTo(n);d=e.text(g[b]);if(e.HtmlEncode)h.text(d);else h.html(d);l&&$(f).insertBefore(h.contents()).text(e.HeaderText+":")})}});if(R&&!e._loadAtTop)G=$(String.format('<li data-icon="none"><a href="#" class="dv-load-at-bottom"><p>{0}</p></a></li>',tb.Loading)).appendTo(i);if(e._loadAtTop)o==0&&q.remove();if(B==0&&h._showDescription!=a&&(!e.lookupInfo()||!ab())){var O=e.instruction();O&&$(Fc).insertBefore(i.find(w)).html(O)}!h._totalRowCount&&$('<li data-icon="refresh"><a class="dv-action-refresh"><p/></a></li>').appendTo(i).find("p").text(Bc.NoRecords);i.listview(I);if(e._loadAtTop){var G=i.find("li.dv-item:eq("+D+")");$(window).scrollTop(G.offset().top-H-$appfactory.mobile.toolbar().outerHeight())}if(v||!e._synced){var x=i.find(r),M=i.find("a.dv-load-at-top"),L=M.length?M.outerHeight():0,V=$appfactory.mobile.screen();if(x.length){var U=x.offset().top,X=Math.floor((V.height-x.outerHeight())/2),Q=U-X-L+2;$(window).scrollTop(Q>0?Q:L);if(v){e.tap(x.data(m).row,J);h.raiseSelected()}setTimeout(function(){$appfactory.mobile.fetchOnDemand()},10)}else if(!e._synced&&h.get_selectedKey().length)setTimeout(function(){h.sync()},10);else e.clearSelection();e._synced=c}e._reset=a;e._loadAtTop=b;!e._loadAtTop&&e.stateChanged()},reset:function(){this._reset=c},visibleDataRows:function(e){var f=this._dataView,g=b,h=this.pageCount(),a=f._cachedPages;if(a)for(var c=0;c<a.length;c++){var d=a[c];if(d.index==e)return d.rows}return b},pageIndex:function(a){var c=this._dataView;if(typeof a==X){if(a=="bottom"){var d=this.content().parent().find("ul li.dv-item:last a").data(m);if(d)return d.pageIndex}if(a=="top"){var e=this.content().parent().find("ul li.dv-item:first a").data(m);if(e)return e.pageIndex}return c.get_pageIndex()}else if(a==b)return c.get_pageIndex();else c.set_pageIndex(a)},pageCount:function(){var a=this._dataView;return a.get_pageCount()},pageSize:function(){var a=this._dataView;return a.get_pageSize()},instruction:function(){var a=this.lookupInfo(),b=this.viewDescription();if(a){b=String.format(a.field.ItemsDescription||x.LookupInstruction,a.aliasField.HeaderText);if(a.value)b+=String.format(x.LookupOriginalSelection,a.text)}return b},context:function(f){var i=this,g=i.dataView(),k=g._totalRowCount,n=g.get_view().Label,o=g.get_sortExpression(),h=i.commandRow()||[],e=this.lookupInfo(),j=h&&h.length;if(k!=l){f.push({text:n,count:k,theme:y,icon:w,callback:yd});f.push({text:x.Sort,icon:w,desc:od(g),callback:xd});f.push({text:x.Filter,icon:w,callback:sd});(!e||e.value!=b)&&f.push({});dd(g,f,h);if(e)f.push({text:j?i.instruction():b});else Qc(g,f,h);if(e){function m(b,c){var a=$(t+e.pageId+" .app-field-"+e.field.Name);e.value=b;e.text=c;a.val(b);a.prev().text(e.text);history.back();setTimeout(function(){a.siblings(Xb).focus()},d)}j&&f.push({text:x.LookupSelectAction,icon:F,command:E,callback:function(){var c=e.field.ItemsDataValueField,d=e.field.ItemsDataTextField,i=$appfactory.mobile.pageInfo(),b=i.dataView,f,g;!c&&$(b._allFields).each(function(){if(this.IsPrimaryKey){c=this.Name;return a}});!d&&$(b._allFields).each(function(){var b=this;if(!b.Hidden&&!b.OnDemand){d=b.Name;return a}});f=b.findField(c);g=b.findField(d);m(h[f.Index],h[g.Index])}});e.value&&f.push({text:x.LookupClearAction,icon:"forbidden",command:"Clear",callback:function(){m(b,Bc.NullValueInForms)}});!String.isNullOrEmpty(e.field.ItemsNewDataView)&&f.push({text:x.LookupNewAction,icon:"plus",callback:function(){i.executeInContext("New",e.field.ItemsNewDataView,c)}});f.push({});j&&!e.field.tagged(Gc)&&f.push({text:x.LookupViewAction,callback:function(){Web.DataView._defaultUseCase="ObjectRef";i.executeInContext(E,"editForm1",c)}});Qc(g,f,h)}else Tc(["ActionColumn","Grid",Hb],g,f,h)}}};Web.DataView.Extensions.Form=function(a){return new Web.DataView.MobileForm(a)};Web.DataView.MobileForm=function(a){Web.DataView.MobileForm.initializeBase(this);this.dataView(a)};Web.DataView.MobileForm.prototype={initialize:function(){this._editors={};this._initRow()},_initRow:function(){var a=this.dataView(),b=this.inserting()?a._newRow:a._rows[0];a._mergeRowUpdates(b);return this.commandRow(b)},reset:function(){this._reset=c;this._initRow()},options:function(){return{quickFind:a,filterDetails:a}},dispose:function(){this._dispose()},_dispose:function(){var d=this,c=d.content();c.find(f).data(m,b);c.find(Ib).selectmenu(G);for(var e in d._editors){var a=d._editors[e];a.field=b;a.originalField=b;$(a.item).remove();delete a.item;$(a.label).remove();delete a.label;$(a.readers).remove();delete a.readers;$(a.writers).remove();delete a.writers}d._editors={};c.find("div.app-status-bar").remove();c.find('div[data-role="navbar"]').navbar(G).remove();c.find(Wb).listview(G).remove();c.find(oc).collapsible(G).remove();c.find(pc).collapsibleset(G).remove()},refresh:function(){var m="nav-context",h=this,i=h.dataView(),Q=i._fields,O=i._allFields,A=i._categories,o=h.content(),x,p=[],D=[],w,C="_",y,k=[],S=h.itemMap(),z,P=this.inserting(),N=this._reset,G;$appfactory.mobile.toolbar(i.get_view().Label);$.mobile.activePage.addClass("app-form-page");if(N){h._dispose();h._commandRow=b;$(window).scrollTop(0)}G=h._editors;x=h.commandRow()||h._initRow()||[];$(A).each(function(){var a=this.Tab;!String.isNullOrEmpty(a)&&p.indexOf(a)==l&&p.push(this.Tab)});if(p.length){var R=$('<div data-role="footer" data-position="fixed"></div>').insertAfter(o).toolbar({tapToggle:a}),M=$('<div data-role="navbar"><ul/></div>').appendTo(R),L=M.find(n);$(p).each(function(){var a=$(K).appendTo($(r).appendTo(L)).text(this);if(!w){w=this;a.addClass("ui-btn-active app-tab-active")}});M.navbar().on(g,function(i){var b="app-tab-active";Fb();var h=$(i.target).closest(f),g=L.find(Vb),d=g.text(),c=h.text(),j;g.removeClass(b);h.addClass(b);D[p.indexOf(d)]=c==d?0:$(window).scrollTop();o.find(pc).each(function(d){var a=A[d].Tab==c,b=$(this).css("display",a?e:J);a&&b.find(Jb).textinput(I)});if(c==d)fd(0);else $(window).scrollTop(D[p.indexOf(c)]||0);return a})}z=i.statusBar();if(z){var E=$('<div class="app-status-bar"/>').html(z).appendTo(o),t=E.find(".Current"),u,v,s;if(t.length){u=t.outerWidth();v=t.offset().left;s=$(window).width();if(ab())s-=$(cc).outerWidth();v+u+20>s&&E.find(n).css("margin-left",t.is(".Last")?-(v+u-s)-20:-(v-(s-u)/2))}}if(i._showDescription!=a){var B=h.viewDescription();if(B){var F=$('<ul data-role="listview" class="app-list-instruction"/>').appendTo(o);$(Fc).appendTo(F).html(B);F.listview()}}$(A).each(function(){var b=".dv-object-identifier";collapsibleSet=$('<div data-role="collapsible-set" data-content-theme="a" data-inset="false" data-mini="false"></div>').appendTo(o);var d=this,f=$('<div data-role="collapsible" data-theme="b" data-expanded-icon="carat-d" data-collapsed-icon="carat-r"></div>').appendTo(collapsibleSet),j=i._processTemplatedText(x,d.Description),h=i._formatViewText(hd.DefaultCategoryDescriptions[j],c,j),g,k=c;!this.Collapsed&&f.attr("data-collapsed",yb);var l=$("<h3>").appendTo(f).text(d.HeaderText);g=$('<ul data-role="listview" data-theme="a" data-inset="false"/>').appendTo(f);!String.isNullOrEmpty(h)&&$('<li data-role="list-divider" class="app-list-instruction"></li>').appendTo(g).text(h);$(Q).each(function(){var b=this,h=b,f,c;if(b.CategoryIndex==d.Index){b=O[b.AliasIndex];f=x[b.Index];c=b.text(f);if(C!=d.Tab&&k){if(!y)y=c;$('<span class="dv-object-identifier"/>').text(" - "+y).appendTo(l).hide();C=d.Tab;k=a}var i=$('<li class="ui-field-contain"/>').appendTo(g),j=$('<label class="app-static-label"/>').appendTo(i).text(b.HeaderText+(b.AllowNulls?e:" *"));G[b.Name]={field:b,originalField:h,item:i,label:j,value:f,originalValue:x[h.Index],text:c,readers:[],writers:[]}}});collapsibleSet.collapsibleset().find(n).listview();w&&collapsibleSet.css("display",w==d.Tab?e:J);collapsibleSet.find(oc).collapsible().collapsible("option",{expand:function(a){$(a.target).find(b).hide()},collapse:function(a){$(a.target).find(b).show()}})});if(!P&&!i.get_useCase()){$appfactory.mobile.navContext(k,c);if(k.length){if(k[0].icon==q)k=k.splice(1);if(k){var H=$('<ul data-role="listview" data-inset="true"/>').appendTo(o);$(k).each(function(){$('<a href="#"/>').appendTo($(r).appendTo(H)).text(this.text).data(m,this)});H.listview().on(g,function(e){var c=$(e.target).closest(f).andSelf(f),b=c.data(m);j(c);setTimeout(function(){j();b&&b.callback&&b.callback()},d);return a})}}}h.stateChanged();h._reset=a},collect:function(){var f=this,e=[],b,j=f.dataView(),h=j._allFields,g=this.commandRow(),i=f.inserting(),d,k=f._editors,l;if(!g)return e;$(h).each(function(){var f=this,h=$.mobile.activePage.find("*.app-field-"+f.Name+":input");if(f.OnDemand)return;d=g[f.Index];b={Name:f.Name,OldValue:d,NewValue:d,Modified:a};b.ReadOnly=f.ReadOnly&&!(f.IsPrimaryKey&&i);if(h.length){b.NewValue=h.is(Ib)?h.find("option:selected").data(mb):h.val().trim();b.Modified=c}e.push(b)});return e},stateChanged:function(){var t="app-field-",s=this,z=s.dataView(),G=z._id,F=s.editing(),K=s.inserting(),E=s._editors,C,i,o,f,d,j,A,x,r,J=s.itemMap(),p,g,v,n,u;function q(a,b){$(a).each(function(){if(b)this.appendTo(f.item);else this.detach()})}function w(){v=G+"_"+d.Name+"_Input";x.attr("for",v);g.appendTo(r).attr(k,v).addClass(u);d.Len&&g.attr("maxlength",d.Len);d.Watermark&&g.attr(qc,d.Watermark)}for(C in E){f=E[C];d=f.field;j=f.originalField,x=f.label;r=f.item;i=f.value;o=f.text;u=t+d.Name;p=j.ItemsStyle;if(F&&!j.ReadOnly&&!d.OnDemand&&!(p||e).match(/CheckBoxList/)){q(f.readers,a);if(f.writers.length)q(f.writers,c);else{if(!String.isNullOrEmpty(p)){A=d;d=j;u=t+d.Name;i=f.originalValue;if(p=="Lookup"||p=="AutoComplete"){g=$('<input type="hidden"/>').val(i);w();n=$(zb).appendTo(r);g.appendTo(n);var L=$('<input type="text" class="app-lookup-input"/>').insertBefore(g).attr(k,v),H=$('<a href="#app-lookup" class="ui-btn ui-icon-bullets ui-btn-icon-right ui-corner-all ui-shadow app-lookup"/>').insertBefore(g).text(o).data(m,{field:j,aliasField:A,value:i,text:o,pageId:vb()});M&&H.attr("tabindex",l)}else{g=$("<select>").addClass("app-lookup");$(j.Items).each(function(){var a=this[0],c=this[1],d=$("<option>").attr(mb,a!=b?a.toString():e).data(mb,a).text(c).appendTo(g)});w();g.val(i!=b?i.toString():e);n=g.selectmenu()}}else{var B=d.Rows>1;g=B?$('<textarea data-autogrow="true"/>'):$('<input type="text"/>');w();g.val(i==b?e:o);n=g.textinput();B&&n.textinput(I)}f.writers.push(n)}}else{x.attr("for",e);q(f.writers,a);if(f.readers.length)q(f.readers,c);else{n=$('<div class="ui-input-text ui-body-inherit ui-corner-all app-static-text"/>').appendTo(r);fieldText=$(zb).appendTo(n).addClass(u);f.readers.push(n);d.Index==J.heading&&r.addClass("dv-heading");if(d.OnDemand)if(!i||i.match(/^null/))fieldText.text(Bc.NullValueInForms);else{var D=z.resolveClientUrl(z.get_appRootPath()),y=$(U).appendTo(fieldText).attr(h,String.format("{0}blob.ashx?{1}=o|{2}",D,d.OnDemandHandler,o));if(d.OnDemandStyle==0){$('<img class="app-image-thumb">').appendTo(y).attr(Z,String.format(nc,D,d.OnDemandHandler,o));y.attr(Hc,"image")}else{y.text(Bc.BlobDownloadLink).addClass("ui-link ui-btn ui-btn-icon-left ui-icon-arrow-d ui-btn-inline ui-mini ui-shadow ui-corner-all").appendTo(fieldText.parent());fieldText.remove()}}else{if(d.HtmlEncode)fieldText.text(o);else fieldText.html(o);if(Xc(d)&&i)$('<a class="ui-btn-right ui-link ui-btn ui-icon-phone ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"></a>').appendTo(fieldText).attr(h,xb+i);else Ad(j)&&j.ItemsDataController&&i&&!j.tagged(Gc)&&$('<a href="#app-details" class="ui-btn-right ui-link ui-btn ui-icon-carat-r ui-btn-icon-notext ui-shadow ui-corner-all app-btn"></a>').appendTo(fieldText).attr(rc,j.Name)}}q(f.writers,a)}}sb()},context:function(a){var c=this,b=c.dataView(),d=c.commandRow(),e=c.editing();dd(b,a,d);!e&&Qc(b,a,d);Tc(["Form",Hb],b,a,d);e&&a.push({text:Bd.RequiredFiledMarkerFootnote})}};var Vc,Sc,Rc;Web.DataView.alert=function(e,k){Vc=k;var b=$("#app-popup-alert"),l=vb(),c=$(Ic);if(b.length==0){b=$(String.format('<div id="app-popup-alert" class="app-popup app-popup-alert" data-theme="a" data-overlay-theme="a" data-dismissible="false" data-history="false"><div class="ui-header ui-bar-a" role="banner"><h1 class="ui-title" role="heading" aria-level="1">{0}</h1></div>'+Jc+'<div class="message"/><a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-b">{1}</a>'+nb+nb,$appfactory.mobile.appName(),hc.Close)).appendTo(u).popup(xc());b.find(f).on(g,function(){if(c.length){ub=function(){c.popup(z)};zc=Vc}else ub=Vc;j(this);setTimeout(function(){b.popup(o)},d);return a})}var h=b.find(Kc);if(e.match(/<\w+/))h.html(e);else h.text(e);function i(){b.popup(z)}if(c.length){ub=i;c.popup(o)}else i()};Web.DataView.confirm=function(e,l,k){Sc=l;Rc=k;var b=$("#app-popup-confirm"),m=vb(),c=$(Ic);if(b.length==0){b=$(String.format('<div id="app-popup-confirm" class="app-popup app-popup-confirm" data-role="popup" data-theme="a" data-overlay-theme="a" data-dismissible="false" data-history="false"><div class="ui-header ui-bar-a" role="banner"><h1 class="ui-title" role="heading" arial-level="1">{0}</h1></div><div role="main" class="ui-content"><div class="message"/><div class="ui-grid-a"><div class="ui-block-a"><a href="#" class="confirm-button ui-btn ui-corner-all ui-shadow ui-btn-b">{1}</a></div><div class="ui-block-b"><a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-b">{2}</a></div></div></div>'+nb,$appfactory.mobile.appName(),hc.OkButton,hc.CancelButton)).appendTo(u).popup(xc());b.find(f).on(g,function(f){var e=$(f.target).is(".confirm-button");if(c.length)ub=function(){c.popup(z);zc=e?Sc:Rc};else ub=e?Sc:Rc;j(this);setTimeout(function(){j();b.popup(o)},d);return a})}var h=b.find(Kc);if(e.match(/<\w+/))h.html(e);else h.text(e);function i(){b.popup(z)}if(c.length){ub=i;c.popup(o)}else i()};$appfactory.showMessage=function(a){a&&this.alert(a)};Web.Menu.headerIterators=[];Web.Menu.footerIterators=[];Web.Menu.prototype.initialize=function(){Web.Menu.callBaseMethod(this,"initialize")};Web.Menu.prototype.dispose=function(){};Web.Menu.prototype.updated=function(){Web.Menu.callBaseMethod(this,"updated");$appfactory.mobile&&this.mobileUpdated()};Web.Menu.prototype.mobileUpdated=function(){var m='a[rel="external"]';if(!Web.Menu.MainMenuId){Web.Menu.MainMenuId=this.get_id();Web.Menu.MainMenuElemId=this._element.id}var s=this.get_nodes(),p=$appfactory.mobile;if(!s)return;var v=$("a#app-btn-context").on(g,function(){j(v);setTimeout(function(){ed(db,function(){p.refreshContext(db)}).panel(H)},d);return a}),q=$("a#app-btn-menu"),l,i;q.on(g,function(v){j(q);Fb();if(q.attr(h)==Kb){v.preventDefault();v.stopPropagation();setTimeout(function(){history.back();j()},d);return a}function s(a){setTimeout(function(){j();i.panel(H)},a)}if(!l)setTimeout(function(){var q='<div class="app-menu-footer"/>';j();var I=$('div[data-role="page"]'),v=$();l=$('<div id="AppMenuPanel" data-role="panel" data-position="left" data-position-fixed="true" data-display="overlay" data-theme="b" class="app-nav-panel"/>').appendTo(u);var B=$('<ul data-role="listview"><li data-icon="delete" data-theme="b"><a href="#"></a></li><li data-role="list-divider" data-theme="a" class="app-info"><i><h5 class="appname"></h5></i><p class="welcome"></p></li></ul>').appendTo(l);$(q).appendTo(l);var E=B.find("a:first").html(hc.Close).on(g,function(){j(E);setTimeout(function(){l.panel(o)},d)}),z=l.find('li[data-role="list-divider"]');z.find(".appname").text(p.appName());var A=Web.Menu.headerIterators,D=Web.Menu.footerIterators;if(A.length==0)z.find(Lb).hide();else $(A).each(function(){this.call(z)});var G=$find(Web.Menu.MainMenuId).get_nodes();(function C(l,d,a,j,g){var b="level"+g;a.addClass(b);j.addClass(b);v=v.add(a);$(l).each(function(v){var b=this,n=b.url;if(b.children){var o=a.attr(k),p=o+"-"+v,s=n;n=t+p;var l=$('<div data-role="panel" data-position="left" data-position-fixed="true" data-theme="b" data-display="overlay" class="app-nav-panel"/>').appendTo(u).attr(k,p),m=$('<ul data-role="listview" data-theme="b"/>').appendTo(l);$(q).appendTo(l);$(K).appendTo($('<li data-icon="arrow-u" data-theme="b"/>').appendTo(m)).attr(h,t+o).text(x.UpOneLevel);$(U).appendTo($(r).appendTo(m).attr(lb,b.selected?f:y)).attr(h,s).text(b.title);$(ob).appendTo(m);if(b.selected&&!i)i=l;C(b.children,b,l,m,g+1)}if(b.selected&&!i)i=a;if(d&&b.selected)d.selected=c;var z=$(U).appendTo($(r).appendTo(j).attr({"data-icon":b.children?w:e,"class":b.children?"menu-item menu-parent":"menu-item","data-theme":b.selected?f:y})).attr({href:n,title:b.description}).text(b.title)})})(G,b,l,B,0);var F=v.find(n).each(function(){var a=this;$(D).each(function(){this.call(a)})});F.listview().on(g,m,function(e){if(ic())return a;var c=$(e.target),b=c.attr(h);if(b&&b.match(/#/))return;!Cb&&j(c);Eb=function(){setTimeout(function(){window.location.href=b},d)};Ac();return a}).on(wb,function(){Cb=c}).on("vmousescroll",function(){});var H;l=v.panel({beforeopen:function(){p.pageScrolling(a)},open:function(){i=$(this)},beforeclose:function(){},close:function(){p.pageScrolling(c);!Cb&&Eb&&Eb();Eb=b;Cb=a}});if(!i)i=v.slice(0,1);s(100)},d);else s(d);return a});$('div[data-app-role="sitemap"]').attr("class","app-site-map").each(function(){var k=$(this),c=$("<ul>").appendTo(k).attr("data-inset",yb),b=qb&&qb.loggedIn();function e(){var a="#app-welcome",d=$('<li><a href="#"/></li>').appendTo(c).find(f);if($(a).length&&!b)d.attr(h,a).text(L.LoginButton);else qb.loginStatus(d)}qb&&!b&&e();(function i(c,b,a){$(c).each(function(){var c=this,d=$(r).appendTo(b).addClass("depth"+a);if(c.url)$(K).appendTo(d).attr({href:c.url,rel:Mb}).text(c.title);else $(eb).appendTo(d).text(c.title);c.children&&i(c.children,b,a+1)})})(s,c,1);qb&&b&&e();c.listview().on(g,m,function(c){var b=$(c.target);j(b);setTimeout(function(){window.location.href=b.attr(h)},d);return a})})};if(typeof Web.Membership!=kd){Web.Membership.prototype.initialize=function(){var f=this,h=f.get_authenticationEnabled(),i=f.get_displayMyAccount(),k=f.loggedIn();Web.Menu.headerIterators.push(function(){var l=$(this).closest(n),p=f.get_cultures();if(!String.isNullOrEmpty(p)&&!(__tf!=4)){var i={value:"Detect,Detect",text:L.AutoDetectLanguageOption,selected:a},m=[i],s=b;$(p.split(/;/)).each(function(){if(this.length){var b=this.split("|"),a={value:b[0],text:b[1],selected:b[2]=="True"};m.push(a);if(a.selected)i=a}});var r=$(String.format('<li data-icon="location" data-theme="b"><a href="#" rel="external">{0}</a></li>',i.text)).appendTo(l).on(g,function(){if(ic())return a;!Cb&&j(r);Eb=function(){var a="#LanguageSelectorPage",b=$(a);if(b.length==0){b=$(String.format('<div id="LanguageSelectorPage" data-role="page" data-app-toolbar="false"><div data-role="header" data-position="fixed"><a href="#app-back" data-icon="back" data-iconpos="notext"></a><h1>{0}</h1></div><div data-role="content"><ul data-role="listview" data-inset="false"></ul></div></div>',L.ChangeLanguageToolTip)).appendTo(u);var h=b.find(n);$(m).each(function(){var a=this,b=$(String.format('<li{1}><a href="#">{0}</a></li>',a.text,a.selected?' data-theme="b"':e)).appendTo(h);b.on(g,function(){j(b);setTimeout(function(){f.changeCulture(a.value)},d)})})}$.mobile.changePage(a,{changeHash:c})};Ac();return a})}var h=this.find(Lb);if(k){var q=f.get_welcome();if(String.isNullOrEmpty(q))h.hide();else h.html(String.localeFormat(q,f.get_user(),new Date))}else{h.hide();var o=$(String.format('<li data-icon="lock" data-theme="b"><a>{0}</a></li>',L.LoginLink)).appendTo(l);o.on(g,function(){!Cb&&j(o);Eb=function(){f.showLogin()};Ac()});$(ob).appendTo(l)}});k&&(i||h)&&Web.Menu.footerIterators.push(function(){var b=this;$('<li data-role="list-divider" data-theme="b"/>').appendTo(b);i&&$(b).is(".level0")&&$(String.format("<li>{0}</li>",L.MyAccount)).appendTo(b);if(h){var c=$(String.format('<li data-icon="power" data-theme="b"><a>{0}</a></li>',L.LogoutLink)).appendTo(b);c.on(g,function(){if(ic())return a;!Cb&&j(c);Eb=function(){$.mobile.loading(hb);ad();f.logout()};Ac()})}})};Web.Membership.prototype.dispose=function(){};Web.Membership.prototype.updated=function(){var a=this;qb=a;Yc();if(a.get_idleTimeout())$(document).on(sc,function(){return!qb.idle()});a.idleInterval(c);$appfactory.mobile&&a.mobileUpdated()};Web.Membership.prototype._idle=function(){Fb();var b=this;b.idleInterval(a);$appfactory.alert(L.UserIdle,function(){ad();b.logout()})};Web.Membership.prototype.loginStatus=function(f){var b=this,c=b.loggedIn(),e=$(f).text(c?L.LogoutLink:L.LoginLink).on(g,function(f){j(e);setTimeout(function(){j();if(c){ad();b.logout()}else b.showLogin()},d);f.preventDefault();return a})};Web.Membership.prototype.mobileUpdated=function(){var a=this,b=a.loggedIn();!b&&location.href.match(/(\?|&)ReturnUrl=/)&&setTimeout(function(){a.showLogin()},500);this.loginStatus('a[data-app-role="loginstatus"]')};Web.Membership.prototype.showLogin=function(){var b=this,c=b._loginDialog;if(!c){b._login_CompletedHandler=Function.createDelegate(b,b._login_Completed);b._method_FailureHandler=Function.createDelegate(b,b._method_Failure);c=b._loginDialog=$(String.format('<div id="app-popup-login" data-role="popup" data-theme="a" data-overlay-theme="a" class="app-popup app-popup-login"><div role="banner" class="ui-header ui-bar-a"><h1 class="ui-title" role="heading" aria-level="1">{6}</h1></div>'+Jc+'<div>{1} {2}</div><input type="text" id="UserName" placeholder="{3}"/><input type="password" id="Password" placeholder="{4}"/>{5}<a href="#" class="login-button ui-btn ui-corner-all ui-shadow ui-btn-b">{7}</a></div></div>',L.HelpCloseButton,L.LoginLink,L.LoginText,L.UserName.replace(/:/,e),L.Password.replace(/:/,e),b.get_displayRememberMe()?String.format('<label for="RememberMe"><input type="checkbox" id="RememberMe" />{0}</label>',L.RememberMe):e,$appfactory.mobile.appName(),L.LoginButton)).appendTo(u).popup(xc());var h=b;b._userName=c.find(Xb).textinput().get(0);b._password=c.find("input:password").textinput().get(0);b._rememberMe=c.find("input:checkbox").checkboxradio().get(0);var f=c.find("a.login-button").on(g,function(){j(f);setTimeout(function(){h.login()},d);return a});c.find("input").on("keydown",function(b){if(b.which==13){f.trigger(g);return a}})}c.popup(z)}}Web.Mobile=function(){var a=this;a._pageMap={};a._pages=[];a._toolbar=$("#app-bar-tools");a._title=a._toolbar.find("h1");a._infoBar=$("#app-bar-info");a._filterBar=$("#app-bar-filter");a._headingBar=$("#app-bar-heading");a._modalDataViews=[];a._modalStack=[]};Web.Mobile.prototype={appName:function(){return $("#PageHeaderBar").text()},height:function(){var a=$(window).height();if(navigator.userAgent.match(/Mobile.+Safari/)&&!navigator.userAgent.match(/Chrome/))a+=60;return a},page:function(a){if(!a)a=Yb;var b=$(t+a);if(b.length==0)b=$(String.format('<div data-role="page" id="{0}"><div data-role="content"></div></div>',a)).appendTo(u).page();return b},activeLink:function(a,d){$.mobile.removeActiveLinkClass(c);if(a){a=$(a);if(!a.is(f))a=a.find("a:first");a.addClass(Lc);if(d==b||d)$.mobile.activeClickedLink=a}},blink:function(b,a){j(b);setTimeout(function(){j();setTimeout(function(){j(b);setTimeout(function(){j();a&&a()},d)},d)},d)},content:function(a){var b=this.page(a);return b.find('div[data-role="content"]')},dataView:function(){var a=this.pageInfo();return a?a.dataView:b},pageInfo:function(a){if(!a)a=vb();else if(a.selector!=b&&a.length!=b)a=a.attr(k)||e;if(typeof a==X)return this._pageMap[a];else{this._pageMap[a.id]=a;this._pages.push(a)}},toolbar:function(b){var a=this;if(typeof b=="boolean"){if(b)a._toolbar.show();else a._toolbar.hide();$.mobile.resetActivePageHeight()}else typeof b==X&&a._title.text(b);return a._toolbar},search:function(a){var d="ui-input-clear-hidden",c=this._searchText;if(!c||!c.length)c=this._searchText=$(tc);if(a!=b)if(typeof a=="object"){a.placeholder&&c.attr(qc,a.placeholder);if(a.text!=b){c.val(a.text);var e=c.parent().find(f);if(a.text)e.removeClass(d);else e.addClass(d)}a.focus&&c.focus()}else typeof a==X&&c.val(a);else return c.val()},infoBar:function(){return this._infoBar},headingBar:function(){return this._headingBar},filterBar:function(){return this._filterBar},infoView:function(a,d){var b=[{text:d?hc.Close:x.Back,callback:d?function(){}:jc,icon:d?"delete":q}];while(a){var e=a.extension().commandRow();b.push({text:a.get_view().Label,theme:y,"static":c});$(a._fields).each(function(){var d=a._allFields[this.AliasIndex];if(!d.Hidden&&!d.OnDemand){v=d.text(e[d.Index]);if(Xc(d))b.push({text:v,desc:d.HeaderText,href:xb+v,icon:T});else b.push({text:v,desc:d.HeaderText,"static":c})}});a=$appfactory.find(a._filterSource)}Q=b;Rb("#app-panel-info-view")},modalDataView:function(b){var a=this;if(!b){$(a._modalStack).each(function(c){var b=this,e=$(t+b.id),d=b.dataView;d.dispose();e.page(G).remove();var c=a._modalDataViews.indexOf(b.id);a._modalDataViews.splice(c,1);c=a._pages.indexOf(b);a._pages.splice(c,1)});a._modalStack=[]}else{var d=a.pageInfo(b),e=a.page(b);if(!d.dataView._lookupInfo){!e.is("app-modal-page")&&e.addClass("app-modal-page app-form-page");d.dataView._isModal=c}a._modalDataViews.push(b);a.changePage(b)}},unloadPage:function(h,d){var b=this,a=b.pageInfo(h),e;if(a){e=b._modalDataViews.indexOf(a.id);if(e>=0){var g=a.dataView,f=$appfactory.find(g._parentDataViewId),c=b.pageInfo(d);if(c&&f==c.dataView||d.attr(k)==Yb)b._modalStack.indexOf(a)==l&&b._modalStack.push(a)}}},changePage:function(c,d){var b=$appfactory.mobile.pageInfo();if(b)b.scrollTop=$(window).scrollTop();this.page(c);$.mobile.changePage(t+c,{changeHash:!(d==a),transition:J})},title:function(){var c=vb(),a=this.pageInfo(c),d=a&&a.dataView,b=document.title;if(a&&a.text!=b)b=String.format(uc,a.text,b);return b},pageScrolling:function(d){var h="lastAdjustment",m=this._scrollLock||0,f=V(),j=f.data(h);m+=d?l:1;this._scrollLock=m;if(!(d&&m==0||!d&&m==1))return;if(M&&!d&&!jb)jb=-$(window).width();u.css("overflow",d?B:C);if(M&&!d&&jb<0)jb+=$(window).width();if(M){var k=".ui-header.ui-header-fixed,.ui-footer.ui-footer-fixed,.app-bar-heading",i=".ui-content,.app-listview",g=wc();if(ab()){var r=g?jb:0;if(d){j&&f.width(f.width()-j).data(h,b);f.css(p,e);$.mobile.activePage.find(i).css(O,e);u.find(k).css(cb,e).width(B);!g&&$(D).css(p,Qb()?C:Y)}else{j&&f.width(f.width()-j);!g&&$(D).css(p,C);var o=f.width()+r;g&&f.width(o).data(h,r).css(O,e);$.mobile.activePage.find(i).css(O,o);u.find(k).css(cb,o).width(B)}}else if(d){$.mobile.activePage.find(i).css(O,e);u.find(k).css(cb,e).width(e);!g&&$(D).css(p,Y)}else{$.mobile.activePage.find(i).css(O,jb);u.find(k).css(cb,jb).width(B);!g&&$(D).css(p,C)}}var q=this;if(d)u.off("touchmove touchstart");else u.on(Zb,function(b){var c=b.originalEvent.touches[0]||b.originalEvent.changedTouches[0];q._startClientY=c.clientY;Db=a}).on(Mc,function(e){Db=a;var d=$(e.target).closest(".ui-panel"),b=d.length==0;if(!b){var j=d.find(n),i=d.find(ac),g=j.height()+(i.length?i.outerHeight():0),f=d.height(),m=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0],k=m?m.clientY:l,h=j.parent().scrollTop();if(g<=f)b=c;else if(g-h<=f){if(q._startClientY>k)b=c}else if(h==0)if(q._startClientY<k)b=c}if(b){Db=c;return a}})},navContext:function(g,h){var i=this,f=i.pageInfo(),r=f,d=f&&f.dataView,o=d,k=o&&o.extension(),p=d&&d.get_useCase(),j=d&&d.extension(),m=c,n=l;if(j){if(!h)j&&j.context(g);if(f.dataView._parentDataViewId){f=i.pageInfo(f.dataView._parentDataViewId);d=f.dataView;n--}}k&&!k.inserting()&&!k.lookupInfo()&&$(this._pages).each(function(){var l=this,e=l.dataView,k=e.extension(),f=c,j=a;if(e){f=!e._hidden&&!e._parentDataViewId;if(f)if(d&&d._filterSource){f=$appfactory.find(d._filterSource)==e;j=f;if(!f)f=$appfactory.find(e._filterSource)==d}else if(e._filterSource)f=$appfactory.find(e._filterSource)==d;else f=!e._filterSource&&e!=d&&!h}if(f&&!p){if(m){!h&&g.push({});m=a}g.push({text:j?i.infoBar().find(".app-item-heading").text():this.text,desc:j?this.text:b,icon:j?q:b,count:j?b:k&&!k._reset?e._totalRowCount:b,callback:j?function(){window.history.go(n)}:function(){i.changePage(l.id)}})}});if(!h&&(ab()||kb)){g.push({});g.push({text:kb?x.Dock:x.Undock,toolbar:a,icon:kb?"arrow-l":"arrow-r",callback:function(){pd(!kb);sb();M&&V().width(e).trigger(R)}})}},refreshAppButtons:function(v){var k="ui-icon-",n=this,s=n._title.offset().left+n._title.outerWidth()-1,e,b,x,j=[],f,d=[],p,o,r,h=$appfactory.mobile.dataView(),t=h&&h.get_isGrid()&&h.get_showQuickFind(),m=0;n.toolbar().find(Nc).each(function(){e=$(this);e.show();if(e.offset().left>s)j.push(e);else e.hide()});f=j.length;if(f>0){$(v).each(function(){b=this.icon;showOnToolbar=this.toolbar!=a&&b!=w&&b!=q;if(b)if(b==I)o=c;else if(b==T)p=c;else if(b==gb&&showOnToolbar)r=c;else showOnToolbar&&d.indexOf(b)==l&&d.push(b)});p&&d.push(T);r&&d.push(gb);o&&d.push(I);if(t)if(d.length<f)d.push(Nb);else d[f-1]=Nb;if(d.length<f)m=f-d.length;for(i=0;i<m;i++)$(j[i]).hide();while(i<f){e=$(j[i]);b=d[i-m];var u=e.data(pb);e.removeClass(k+u).addClass(k+b).data(pb,b);i++}if(h&&h.get_searchOnStart()){h.set_searchOnStart(a);$(".app-btn.ui-icon-search").trigger(g)}}},refreshContext:function(m,d){var i=this,g=$(m),e=g.find(n),l=Pc?e.outerHeight():0,k,j=a;if(!e.length||g.is(".app-sidebar-right:not(:visible)")){d=[];i.navContext(d);i.refreshAppButtons(d);return}e.find(f).data(S,b);if(l)k=$(zb).height(l).insertAfter(e);e.find(P).remove();if(!d){d=[];i.navContext(d)}$(d).each(function(){var d=this,g=$("<li></li>").attr({"data-icon":d.icon,"data-theme":d.theme||f}).appendTo(e),i,k=a,l;if(d.callback||d.dataRel){i=$('<a href="#"></a>').appendTo(g).text(d.text).data(S,d);d.count!=b&&$('<span class="ui-li-count"></span>').appendTo(i).text(d.count);d.dataRel&&i.attr("data-rel",d.dataRel)}else if(d.href){g.attr(Ub,d.icon);i=$('<a href="#" rel="external"></a>').appendTo(g).text(d.text).data(S,d).attr(h,d.href)}else if(d.static)g.html(d.text);else{if(j)g.remove();else{l=g.attr("data-role","list-divider").html(d.text);!d.static&&l.addClass("app-list-instruction")}j=c;k=c}if(!k)j=a;d.desc&&$('<p class="app-item-desc"></p>').appendTo(i?i:g).text(d.desc);d.disabled&&g.addClass("ui-disabled")});e.listview(I);nd(g);k&&k.remove();g.is(cc)&&i.refreshAppButtons(d)},filterStatus:function(){var g=this.filterBar().hide(),j=this.pageInfo(),a=j.dataView,d=a&&a.extension(),h=a?a.get_filter():b;if(a&&h.length>0&&!a.filterIsExternal()&&d&&d.options().filterDetails){var c=g.find(f),i=new Sys.StringBuilder;c.children().remove();a._renderFilterDetails(i,h);$(eb).appendTo(c).html(i.toString().replace(rd,e).replace(qd,'"'));g.show()}},focus:function(k,l){var j=this,d=$.mobile.activePage.find(".app-field-"+k),f,b,i=j.screen(),h,e=$(".app-popup-message");if(e.length)return;if(d.length){f=d.closest(P);b=f.offset().top;if(b<i.top||b+f.outerHeight()>i.bottom){h=b-(i.height-f.outerHeight())/2;$(window).scrollTop(h>0?h:0)}e=$('<div class="ui-content app-popup-message"/>').html(l).popup({history:a,arrow:"t,b",positionTo:d,afteropen:function(){j.pageScrolling(a)},afterclose:function(){e.popup(G).remove();d.focus();j.pageScrolling(c)}}).popup(z).on(g,function(){e.popup(o);return a})}},showLookup:function(a){var g=this,j=g.pageInfo(),h=j.dataView,i=a.field,e,d,f;g.modalDataView();e=a.field.ItemsDataController.toLowerCase();if($find(e))e+=Sys.Application.getComponents().length;d=$create(Web.DataView,{id:e,baseUrl:h.get_baseUrl(),servicePath:h.get_servicePath(),controller:i.ItemsDataController,viewId:i.ItemsDataView},b,b,$(zb).hide().appendTo(u).attr(k,e+"Placeholder")[0]);f=g.pageInfo(d._id);a.query&&d.set_quickFindText(a.query);f.text=a.aliasField.HeaderText;f.resolved=c;d._lookupInfo=a;if(a.value!=b){d._syncKey=[a.value];d._selectedKey=[a.value]}d._parentDataViewId=h._id;g.modalDataView(f.id)},pageShow:function(x){var l="ui-icon-back",j="ui-icon-home",d=this,g=d.pageInfo(x);if(g==b)return;var a=g.dataView,n=a?a.extension():b,w=d.infoBar().hide(),s=d._modalStack.indexOf(g),r=$(bc);s>=0&&d._modalStack.splice(s,1);if(a){if(a._filterSource){var i=$appfactory.find(a._filterSource);if(i){var q=i.extension(),o=q.itemMap(),t=i._allFields,p=q.commandRow(),m;if(o&&p){var e=w.find(f).data(Tb,i._id);e.children().remove();a._parentDataViewId&&$('<span class="app-bar-label"/>').appendTo(e).text($appfactory.find(a._parentDataViewId).get_view().Label);var u=$('<span class="app-item-heading"></span>').appendTo(e),m=t[o.heading];v=p[m.Index];v=m.text(v);if(m.HtmlEncode)u.text(v);else u.html(v);$(o.desc).each(function(){$("<span> | </span>").appendTo(e);var a=t[this],b=$("<span></span>").appendTo(e);v=p[a.Index];v=a.text(v);if(a.HtmlEncode)b.text(v);else b.html(v)});w.show()}}}d.filterStatus()}if(!g.initialized){g.initialized=c;a&&a._loadPage()}n&&n._reset&&n.refresh();if(d.toolbar().is(Ab))if(!(d._pages.length<1||$.mobile.activePage.attr(k)==d._pages[0].id))r.removeClass(j).addClass(l).attr(h,Kb);else r.removeClass(l).addClass(j).attr(h,bc);$("[data-role='navbar'] a.app-tab-active").addClass(Lc)},screen:function(){var b=$.mobile.window.scrollTop(),a=this.toolbar().outerHeight(),c=$.mobile.getScreenHeight();return{top:b+a,bottom:b+$.mobile.getScreenHeight(),height:c-a,width:$(window).width()}},fetchOnDemand:function(){var a=$.mobile.activePage.find(mc);if(a.length){var c=a.offset().top,d=c+a.outerHeight(),b=this.screen();(b.top<=c&&c<=b.bottom||b.top<=d&&d<=b.bottom)&&a.trigger(g)}a=$.mobile.activePage.find(fb);if(a.length){c=a.offset().top;d=c+a.outerHeight();b=this.screen();(b.top<=c&&c<=b.bottom||b.top<=d&&d<=b.bottom)&&a.trigger(g)}return this},headingOnDemand:function(){var c=this,a=$.mobile.activePage.find(".dv-heading .app-static-text"),b=c.headingBar();if(a.length){var e=c.screen(),d=a.offset().top,g=a.outerHeight(),f=b.is(Ab)?b.outerHeight():0;if(d<e.top&&a.is(Ab)){b.css("top",c.toolbar().outerHeight()-1+"px").show().find("span.app-bar-text").text(a.text());b.find("span.app-bar-label").text(a.closest(P).find("label:first").text())}else b.hide()}else b.hide();return c},wait:function(a){$.mobile.loading(a?hb:W)},start:function(){var d=this;if(!(d._appLoaded&&d._pageCreated))return;var g=d,i=$.mobile.activePage.find("a.app-action-navigate"),h=location.href.match(/#(.+)$/),c=h?g.pageInfo(h[1]):b,f=$.mobile.navigate.history;if(c&&(!c.dataView||!c.dataView._filterSource))g.changePage(c.id,a);else if(i.length==1)$(d._pages).each(function(){var c=this.dataView;if(!c||!c._hidden){g.changePage(this.id,a);var b=f.stack[0];f.stack=[b];f.activeIndex=0;if(b.hash){b.hash=e;b.url=$appfactory.unanchor(b.url)}return a}});else if(vb()==Yb){i.show();$appfactory.mobile.pageMenu().listview().show();$(".app-page-menu-desc").show()}},pageMenu:function(){var i=this,a=this.content(),b=a.find("ul.app-page-menu"),e=$(".TaskBox.About .Inner .Value");if(!b.length){var c=$('<p class="app-page-menu-desc"></p>').appendTo(a).hide();b=$('<ul data-role="listview" data-inset="false" class="app-page-menu"></ul').appendTo(a).hide().on(g,function(b){var a=$(b.target);if(!a.is(f))a=a.closest(f);if(a.length){j(a);setTimeout(function(){j();i.changePage(a.attr(h).substring(1))},d);b.preventDefault();b.stopPropagation()}});if(e.length){$("<br/><br/>").appendTo(c.html(e.html()));c.find(f).attr("rel",Mb)}}return b},initialize:function(){var n="app-transparent",c="link-text",j="position",i=".ui-header.ui-header-fixed,.app-bar-heading,.app-sidebar-right",l="ui-focus",f=".app-lookup-input",p="input,textarea,select",x=this,s=(new Date).getTime();function q(){var a=(new Date).getTime();if(a-s>2500){var b=$.Event(sc);$(document).trigger(b);if(b.isDefaultPrevented())return;else a=(new Date).getTime()}s=a;setTimeout(q,1250)}setTimeout(q,10);var v=$appfactory.mobile.pageMenu(),w=$("#PageContent").find('div[data-app-role="page"]').each(function(g){var d=$(this).attr({"data-role":"page","data-app-role":b}).appendTo(u).page(),e=gd(d),a={text:e.text,description:e.description},c=d.attr(k);if(!c){c="UserPage"+g;d.attr(k,c)}a.id=c;$appfactory.mobile.pageInfo(a);var f=$('<a class="app-action-navigate" data-transition="none"></a>').attr(h,t+c).text(a.text).appendTo($(r).appendTo(v));a.description&&$("<p>").appendTo(f).text(a.description)}),o;$(document).on("focus",p,function(b){var a=$(b.target);if(a.is(tc))return;A=a;if(!M){o&&clearTimeout(o);ab()&&wc()&&V().height($(document).height())}a.is(f)&&a.next().addClass(l);!M&&$(i).css(j,"absolute")}).on("blur",p,function(){var g,h,a;if(!A)return;if(A.is(f)){h=A.data(c);g=A.data(c,b).next().removeClass(l);if(h){g.toggleClass("ui-icon-bullets ui-icon-search").removeClass(n);setTimeout(function(){g.text(h)},d)}a=A.val().trim();if(a)g.text(a).data(m).query=a;A.val(e)}A=b;if(!M)o=setTimeout(function(){o=b;ab()&&V().height(e);$(i).css(j,"fixed")},20)}).on(Zb,"a.app-lookup",function(){if(A){var a=A.val().trim();a&&A.next().text(a).removeClass(n)}}).on("keydown",function(b){if(b.which==13&&!$(b.target).is(Jb))if(A){if(A.is(f)){var c=A.val().trim();if(c.length||M){A.next().data(m).query=c;A.next().trigger(g)}}A.blur();return a}}).on("keyup",f,function(d){var a=$(d.target),b=a.next();!a.data(c)&&setTimeout(function(){if(a.val()!=e){a.data(c,b.text());b.html("&nbsp;").toggleClass("ui-icon-bullets ui-icon-search app-transparent")}},10)})}};(function(){var h="scrollable",r='<a href="#" data-role="button" data-icon="gear" data-iconpos="notext" class=" app-btn ui-btn-right"/>',m='<a href="#" data-role="button" data-icon="gear" data-iconpos="notext" class="ui-btn-right app-btn"/>';$.event.special.swipe.scrollSupressionThreshold=100;kb=jd(Dc);u=$("body");M&&u.addClass("app-desktop");kb&&u.addClass(Cc);$("form").hide();var k=$('<div id="app-bar-tools" data-role="header" data-position="fixed" data-theme="a" class="ui-shadow app-bar-tools"></div>"').appendTo(u),z=$('<div data-role="page" id="Main"></div>').appendTo(u);$('<div data-role="content" class="app-content-main"></div>"').appendTo(z);$('<a data-role="button" href="#" id="app-btn-menu" data-icon="home" data-iconpos="notext" data-shadow="false" data-icon-shadow="false">Site Map</a>').appendTo(k);var x=$('<h1 class="ui-title"/>').appendTo(k),o=$('<div class="app-btn-cluster-right"/>').appendTo(k);$(m).appendTo(o);$(m).appendTo(o);$(m).appendTo(o);$(r).appendTo(o);$(r).appendTo(o);$('<a href="#" id="app-btn-context" data-icon="bars" data-iconpos="notext" data-role="button" class="ui-btn-right app-btn-context"/>').appendTo(o);var y=$('<div id="app-bar-info" class="app-bar app-bar-info"><a href="#" class="ui-btn ui-btn-icon-left ui-icon-info"></a></div>').appendTo(k).hide(),F=$('<div id="app-bar-filter" class="app-bar app-bar-filter"><a href="#app-btn-clear-filter" class="ui-btn ui-btn-icon-left ui-icon-delete"></a></div>').appendTo(k).hide();$('<div id="app-bar-heading" class="app-bar-heading ui-overlay-shadow"><span class="app-bar-label"/><span class="app-bar-text"/></div>').appendTo(u).hide();var v=y.find(f).on(g,function(){j(v);!Ob&&setTimeout(function(){j();$appfactory.mobile.infoView($appfactory.find(v.data(Tb)),c)},d);return a}),E=k.find(Nc).data(pb,"gear").on("vclick taphold",function(e){Fb();var m=$(e.target),i=m.data(pb);e.preventDefault();e.stopPropagation();if(i==Nb){ec=$(".ui-title,#app-btn-menu,.app-btn-cluster-right").hide();bb=k.find("#app-controls-find");if(bb.length==0){bb=$('<div id="app-controls-find" class="app-bar-search"><form><label for="app-text-search" class="ui-hidden-accessible">Search:</label><input type="search" id="app-text-search" data-role="search" placeholder="Quick Find - Products" data-mini="true"/><a href="#" data-role="button" data-icon="back" data-iconpos="notext" class="ui-btn-right ui-btn ui-icon-back ui-btn-icon-notext ui-shadow ui-corner-all" ></a></form></div>').insertBefore(x);var b=bb.find("input").textinput({mini:c}).attr("type","text").focus(function(){Pc&&setTimeout(function(){$(window).scrollTop($.mobile.defaultHomeScroll);$('meta[name="viewport"]').attr("viewport","device-width, initial-scale=1,maximum-scale=1, user-scalable=no")},d)}).blur(function(){j(n);setTimeout(function(){j();ec.show();bb.hide();if(Pc){var a=$(fb).show();a.length&&$(window).scrollTop(a.outerHeight())}var b=$appfactory.mobile.dataView();b._totalRowCount==l&&b.sync()},d)});b.parent().find(f).remove();bb.find("form").submit(function(a){a.preventDefault();a.stopPropagation();b.blur();ec.show();bb.hide();var d=$appfactory.mobile.pageInfo(),c=d.dataView.extension();c.quickFind($appfactory.mobile.search());$appfactory.mobile.filterStatus();$appfactory.mobile.toolbar($appfactory.mobile.title())});var n=bb.find("a:last").on(g,function(){b.blur();return a})}var h=$appfactory.mobile.pageInfo(),o=h.dataView.extension().quickFind();if(Pc){$(fb).hide();$(window).scrollTop($.mobile.defaultHomeScroll)}bb.show();$appfactory.mobile.search({text:o,placeholder:String.format(uc,Cd.QuickFindText,h.dataView.get_view().Label),focus:c})}else{j(m);setTimeout(function(){j();var b=[];$appfactory.mobile.navContext(b);$(b).each(function(){var b=this;if(b.icon==i){gc(b);return a}})},250)}return a});k.toolbar();var t,i=$('<div id="app-sidebar-right" class="ui-panel ui-panel-fixed ui-body-a app-sidebar-right ui-shadow"><div class="ui-panel-inner"><ul/><div class="app-menu-footer"/></div></div>').appendTo(u),q=i.find("div:first"),w=q.find(n);i.on(Zb,function(b){var c=b.originalEvent.touches[0]||b.originalEvent.changedTouches[0];t=c.clientY;Db=a}).on(Mc,function(e){if(A)return;Db=a;var d=$(e.target).closest(Bb),b=d.length==0;if(!b){var j=d.find(n),i=d.find(ac),g=j.height()+(i.length?i.outerHeight():0),f=d.height(),m=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0],k=m?m.clientY:l,h=j.parent().scrollTop();if(g<=f)b=c;else if(g-h<=f){if(t>k)b=c}else if(h==0)if(t<k)b=c}if(b){Db=c;return a}}).on(wb,function(){});if(M){function s(c){var a="mouse-over-width",f=q.css(p);if(wc()){if(c&&f!=B||!c&&f!=C){q.css(p,c?Qb()?B:B:C);if(c){if(!Qb()){var d=i.width();i.width(d-jb).css(O,jb).data(a,d)}}else{var g=i.data(a);g&&!Qb()&&i.data(a,b).width(g).css(O,e)}}}else{q.css(p,c?B:C);if(Qb())$(D).css(p,C);else $(D).css(p,Y)}}s(a);i.on(Gb,function(){if(!i.data(h)){i.data(h,c);$appfactory.mobile.pageScrolling(a);s(c)}}).on(R,function(b){if(!$(b.toElement).closest(Bb).length&&i.data(h)){i.data(h,a);s(a);$appfactory.mobile.pageScrolling(c)}})}w.listview().on(g,function(e){if(ic()||Ob||Wc())return a;Fb();M&&i.trigger(R);var c=$(e.target).closest(f);j(c);if(Pb){setTimeout(function(){j()},d);return}var b=c.data(S);b&&setTimeout(function(){j();gc(b)},d);return a})})();$appfactory.mobile=new Web.Mobile;$(document).ready(function(){$appfactory.mobile.initialize()}).contextmenu(function(){return a}).one("pagecreate","#Main",function(){$appfactory.mobile._pageCreated=c}).on(id,"#Main",function(){setTimeout(function(){$appfactory.mobile.start()},100)}).on("pageshow",function(){var a=$appfactory.mobile.pageInfo();if(a){a.scrollTop&&$(window).scrollTop(a.scrollTop);$appfactory.mobile.headingOnDemand()}sb()}).on(id,function(d,c){var a=$appfactory.mobile,b=$.mobile.activePage;a.toolbar($appfactory.mobile.title());a.pageShow(b.attr(k));a.unloadPage(c.prevPage,b);Yc()}).on("pagebeforehide",function(){$(".ui-panel-open").panel(o,c);M&&$(D).css(p,Y)}).on("pagebeforechange",function(h,b){if(typeof b.toPage==X&&b.toPage.match(/http/))return;var c=$appfactory.mobile,f=$(b.toPage),d=c.pageInfo(f.attr(k)),g=f.attr("data-app-toolbar")==yb,e=d&&d.dataView;ec&&ec.show();bb&&bb.hide();extension=e&&e.extension();c.toolbar(!g);c.search({allow:extension?extension.options().quickFind:a})}).on("scrollstart",function(){Oc=c}).on("scrollstop",function(){Oc=a;$appfactory.mobile.fetchOnDemand();$appfactory.mobile.headingOnDemand();Yc()}).on(g,function(p){var n=$(p.target),l=n.is(f)?n:n.closest(f),k=l.attr(h),c;switch(k){case"#app-menu":c=bc;break;case"#app-context":c="#app-btn-context";break;case Kb:c=function(){history.back()};break;case"#app-btn-clear-filter":c=function(){var a=$appfactory.mobile.pageInfo();if(a&&a.dataView){a.dataView.clearFilter();$appfactory.mobile.filterStatus()}};break;case"#app-details":c=function(){var a=$appfactory.mobile.pageInfo(),b;if(a&&a.dataView){b=a.dataView.extension();b.command(b.commandRow(),E);a.dataView._viewDetails(l.attr(rc))}};break;case"#app-lookup":c=function(){var a=l.data(m);Fb();$appfactory.mobile.showLookup(a);a.query=b};break;default:if(k)if(k.match(/^tel/))c=function(){window.location.href=k};else{var o=l.attr(Hc),i;if(o&&o.match(/^image/))c=function(){var a=".app-image-preview-box",b=".app-image-preview";i=$("#app-popup-image");if(!i.length){i=$('<div id="app-popup-image" class="app-popup-image" data-role="popup" data-overlay-theme="b" data-theme="b" data-position-to="window"><a href="#app-back" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right"/><img class="app-image-preview" style="max-width:10000px"/><div class="app-image-preview-box"/>'+nb).appendTo(u).popup(xc(J));i.find(b).on("load",function(k){$.mobile.loading(W);var f=$(k.target).width(e).height(e),h=i.find(a),j=$appfactory.mobile.screen(),c=f.width(),g=j.width*.9,b=f.height(),d=j.height*.9;if(c>g){b*=g/c;c=g;if(b>d){c*=d/b;b=d}}else if(b>d){c*=d/b;b=d}f.hide();h.css({background:e,width:c+"px",height:b+"px"}).show();i.popup("reposition",{positionTo:"window"});h.css({background:String.format("url({0})",f.attr(Z)),"background-size":String.format("{0}px {1}px",c,b)})})}$.mobile.loading(hb);i.find(a).hide();i.find(b).attr(Z,e).width(100).height(e).show().attr(Z,k);i.popup(z)}}}if(c){j(p.target);setTimeout(function(){j();if(typeof c==X)$(c).trigger(g);else c()},d);return a}});$(window).orientationchange(function(){sb()}).resize(function(){sb()});Sys.Application.add_init(function(){});Sys.Application.add_load(function(){$appfactory.mobile._appLoaded=c});Web.DataView.MobileGrid.registerClass("Web.DataView.MobileGrid",Web.DataView.MobileBase);Web.DataView.MobileForm.registerClass("Web.DataView.MobileForm",Web.DataView.MobileBase)})()